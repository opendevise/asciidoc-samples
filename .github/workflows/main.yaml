name: publish techdocs to staging

on:
  workflow_dispatch:
  push:
    paths-ignore:
      - "README.md"
      - ".gitignore"

jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:

      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of sonar analysis

  publish-techdocs-site:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build and publish docs
        uses: idealo/publish-techdocs-action@techdoc-stg
        with:
          plantuml: 'true'
          verbose-logging: 'true'
          doc-source: asciidoc
